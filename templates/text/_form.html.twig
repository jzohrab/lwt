{% form_theme form 'form_table_layout.html.twig' %}

<ul id="texttagslist" class="tags"
    data-index="{{ form.textTags|length > 0 ? form.textTags|last.vars.name + 1 : 0 }}"
    data-prototype="{{ form_widget(form.textTags.vars.prototype)|e('html_attr') }}"
    >
{% for textTag in form.textTags %}
    <li>
        {{ textTag.vars.value.text }}
    </li>
{% endfor %}
</ul>

{{ form_start(form) }}

{{ form_widget(form) }}

  <button class="btn">{{ button_label|default('Save') }}</button>
{{ form_end(form) }}

<script>

  $(document).ready(function () {

    var prototypeFieldName = 'text[textTags][__name__][text]';
    var fieldIndex = 0;
    
    let invalidChar = function(s) { return /[\uD800-\uDFFF]/.test(s); };

    $('#texttagslist').tagit(
      {
        beforeTagAdded: function (_event, ui) {
          if (invalidChar(ui.tag.text())) {
            return;
          }
          fieldIndex++;
          $(this).tagit({fieldName: prototypeFieldName.replace('__name__', fieldIndex)});
        },
        availableTags: TAGS,
        fieldName: 'TermTags[TagList][]'
      });

    }
      
  );

    </script>
